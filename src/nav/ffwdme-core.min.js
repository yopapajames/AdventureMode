/**
 * ffwdme.js - Turn by turn navigation in the browser.
 * @version v0.4.1
 * @copyright Copyright (c) 2011-2015 Christian BÃ¤uerlein, Silvia Hundegger; 2012-2015 flinc GmbH
 * @license MIT
 */
!function t(i,e,n){function o(s,a){if(!e[s]){if(!i[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=e[s]={exports:{}};i[s][0].call(l.exports,function(t){var e=i[s][1][t];return o(e?e:t)},l,l.exports,t,i,e,n)}return e[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,i,e){var n=function(){};n.extend=function(t,i){var e=n.prototype.extend;n._prototyping=!0;var o=new this;e.call(o,t),o.base=function(){},delete n._prototyping;var r=o.constructor,s=o.constructor=function(){if(!n._prototyping)if(this._constructing||this.constructor==s)this._constructing=!0,r.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||e).call(arguments[0],o)};return s.ancestor=this,s.extend=this.extend,s.implement=this.implement,s.prototype=o,s.toString=this.toString,s.valueOf=function(t){return"object"==t?s:r.valueOf()},e.call(s,i),"function"==typeof s.init&&s.init(),s},n.prototype={extend:function(t,i){if(arguments.length>1){var e=this[t];if(e&&"function"==typeof i&&(!e.valueOf||e.valueOf()!=i.valueOf())&&/\bbase\b/.test(i)){var o=i.valueOf();i=function(){var t=this.base||n.prototype.base;this.base=e;var i=o.apply(this,arguments);return this.base=t,i},i.valueOf=function(t){return"object"==t?i:o},i.toString=n.toString}this[t]=i}else if(t){var r=n.prototype.extend;n._prototyping||"function"==typeof this||(r=this.extend||r);for(var s={toSource:null},a=["constructor","toString","valueOf"],c=n._prototyping?0:1;u=a[c++];)t[u]!=s[u]&&r.call(this,u,t[u]);for(var u in t)s[u]||r.call(this,u,t[u])}return this}},n=n.extend({constructor:function(){this.extend(arguments[0])},bind:function(t,i){return function(){return t.apply(i,arguments)}},bindAll:function(t){for(var i=Array.prototype.slice.call(arguments,1),e=0,n=i.length;e<n;e++){var o=i[e];t[o]=this.bind(t[o],t)}return t}},{ancestor:Object,implement:function(){for(var t=0;t<arguments.length;t++)"function"==typeof arguments[t]?arguments[t](this.prototype):this.prototype.extend(arguments[t]);return this},toString:function(){return String(this.valueOf())}}),i.exports=n},{}],2:[function(t,i,e){var n=t("./class"),o=n.extend({constructor:function(t){this.geoProvider=t,this.bindAll(this,"positionUpdate","positionError")},watching:!1,watchId:null,options:null,geoProvider:null,last:null,getCurrentPosition:function(t,i,e){this.geoProvider.getCurrentPosition(t,i,e)},watchPosition:function(t,i,e){i&&ffwdme.on("geoposition:update",i),e&&ffwdme.on("geoposition:error",e),this.watching||(this.watchId=this.geoProvider.watchPosition(this.positionUpdate,this.positionError,t),this.options=t,this.watching=!0,ffwdme.trigger("geoposition:init"))},clearWatch:function(){this.geoProvider.clearWatch(this.watchId)},positionUpdate:function(t){var i={geoposition:t,point:new ffwdme.LatLng(t.coords.latitude,t.coords.longitude)},e=!1;this.last||(e=!0),this.last=i,e&&ffwdme.trigger("geoposition:ready",i),ffwdme.trigger("geoposition:update",i)},positionError:function(t){ffwdme.trigger("geoposition:error",{error:t})}});i.exports=o},{"./class":1}],3:[function(t,i,e){(function(i){var e=t("./class"),n=t("./geolocation"),o=t("./lat_lng"),r=t("./navigation"),s=t("./route"),a=t("./navigation_info"),c=t("./routing/base"),u=t("./routing/graph_hopper"),l=t("./utils/geo"),h=t("./utils/proxy");!function(t,i){var f={Class:e,Geolocation:n,LatLng:o,Navigation:r,NavigationInfo:a,Route:s,routing:{Base:c,GraphHopper:u},utils:{Geo:l,Proxy:h},initialize:function(t){t=t||{},this.options=t,t.geoProvider||(t.geoProvider=window.navigator.geolocation),this.geolocation=new f.Geolocation(t.geoProvider),t.ingoreGeolocation||this.geolocation.watchPosition({enableHighAccuracy:!0,maximumAge:3e4,timeout:3e4}),t.routing&&f.routing[t.routing]&&(this.routingService=f.routing[t.routing]),this.navigation=new f.Navigation},VERSION:"0.4.0",callbacks:null,defaults:{imageBaseUrl:"components/",audioBaseUrl:"components/audio_instructions/voices/"},options:{},geolocation:null,navigation:null,routingService:null,reset:function(){this.callbacks=null,this.geolocation&&this.geolocation.clearWatch(),this.geolocation=null,this.routingService=null,this.navigation=null},on:function(t,i){this.callbacks=this.callbacks||{};for(var e,n=t.split(" "),o=0,r=n.length;o<r;o++)e=n[o],this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(i);return this},once:function(t,i){var e=function(n){i(n),f.off(t,e)};return this.on(t,e),this},off:function(t,i){if(!this.callbacks||!this.callbacks[t])return this;for(var e=this.callbacks[t],n=0,o=e.length;n<o;n++)if(e[n]===i)return this.callbacks[t].splice(n,1),this;return this},trigger:function(t,i){if(this.callbacks=this.callbacks||{},!this.callbacks[t])return this;var e=this.callbacks[t];i||(i={}),i.type=t;for(var n=e.length,o=n-1;o>=0;o--)e[o](i);return this},toString:function(){return"ffwdme.js v"+this.VERSION}};t.ffwdme=f}("undefined"!=typeof window?window:i)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./class":1,"./geolocation":2,"./lat_lng":4,"./navigation":5,"./navigation_info":6,"./route":7,"./routing/base":8,"./routing/graph_hopper":9,"./utils/geo":10,"./utils/proxy":11}],4:[function(t,i,e){var n=function(t,i){"[object Array]"===toString.call(t)&&(i=t[1],t=t[0]),t=parseFloat(t),i=parseFloat(i),t=Math.max(Math.min(t,90),-90),i=(i+180)%360+(i<-180?180:-180),this.lat=t,this.lng=i};n.prototype={toString:function(){return"LatLng: "+this.lat+", "+this.lng}},i.exports=n},{}],5:[function(t,i,e){var n=t("./class"),o=t("./utils/geo"),r=n.extend({constructor:function(t){this.bindAll(this,"getPositionOnRoute","rerouteCallback")},route:null,_lastPositionsOnRoute:[],_currentPositionOnRoute:null,_lastDirectionPathIndex:null,_lastDrivingDirectionIndex:null,startTime:null,startTimeByDirection:{},offRouteCounter:0,offRouteStartTimestamp:0,routePointCounter:0,offRouteTime:0,reset:function(){this._lastPositionsOnRoute=[],this._currentPositionOnRoute=null,this._lastDirectionPathIndex=null,this._lastDrivingDirectionIndex=null,this.offRouteCounter=0,this.offRouteStartTimestamp=0,this.routePointCounter=0},setRoute:function(t){return this.reset(),this.route=t,this},reroute:function(t){t||(t={});var i=this.route.directions,e=i[i.length-1],n=e.path?e.path[e.path.length-1].lat:e.start.lat,o=e.path?e.path[e.path.length-1].lng:e.start.lng;ffwdme.on("reroutecalculation:success",this.rerouteCallback),t.dest=new ffwdme.LatLng(n,o),t.rerouting=!0;new ffwdme.routingService(t).fetch()},rerouteCallback:function(t){ffwdme.off("reroutecalculation:success",this.rerouteCallback),this.setRoute(t.route)},start:function(){this.getPositionOnRoute(ffwdme.geolocation.last),ffwdme.on("geoposition:update",this.getPositionOnRoute),this.startTime=Date.now()},stop:function(){ffwdme.off("geoposition:update",this.getPositionOnRoute)},notFoundOnRoute:function(t){0===this.offRouteCounter?this.offRouteStartTimestamp=Date.now():this.offRouteTime=Date.now()-this.offRouteStartTimestamp,this.offRouteCounter++,ffwdme.trigger("navigation:offroute",{navInfo:t})},getPositionOnRoute:function(t){var i,e=30;if(this._lastDrivingDirectionIndex)for(var n,o=this.approachInSteps(),r=o.length,s=0;s<r&&(n=o[s],i=this.route.nearestTo(t.point,n.dIndex,n.pIndex,n.max),!(i.point&&i.distance<e));s++);else i=this.route.nearestTo(t.point,0,0);this.routePointCounter++;var a=new ffwdme.NavigationInfo({nearest:i,raw:t,navigation:this,route:this.route,onRoute:!!(i.point&&i.distance<e)});return a.onRoute?(this.offRouteCounter=0,ffwdme.trigger("navigation:onroute",{navInfo:a})):this.notFoundOnRoute(a)},approachInSteps:function(){return[{dIndex:this._lastDrivingDirectionIndex,pIndex:this._lastDirectionPathIndex,max:2},{dIndex:Math.max(this._lastDrivingDirectionIndex-2,0),pIndex:0,max:5},{dIndex:Math.max(this._lastDrivingDirectionIndex-4,0),pIndex:0,max:10},{dIndex:0,pIndex:0,max:!1}]}}).implement(o);i.exports=r},{"./class":1,"./utils/geo":10}],6:[function(t,i,e){var n=t("./class"),o=n.extend({constructor:function(t){this.position=t.nearest.point,this.positionRaw=t.raw.point,this.nearest=t.nearest,this.raw=t.raw,this.navigation=t.navigation,this.route=t.route,this.finalDirection=this.nearest.directionIndex+1===this.route.directions.length,this.arrived=this.finalDirection&&ffwdme.utils.Geo.distance(this.positionRaw,this.route.destination())<=35,this.onRoute=t.onRoute,this.onRoute&&(this.currentDirection=this.route.directions[this.nearest.directionIndex],this.nextDirection=this.route.directions[this.nearest.directionIndex+1],this.calculateDistances(),this.calculateRatios(),this.calculateTimes())},calculateRatios:function(){var t=this.currentDirection.distance-this.distanceToNextDirection,i=t/this.currentDirection.distance,e=Math.round;i=e(100*i)/100,i<.01&&(i=.01),this.ratioCompletedDirection=i;var n=(this.route.summary.distance-this.distanceToDestination)/this.route.summary.distance;n=e(100*n)/100,n<.01&&(n=.01),this.ratioCompletedRoute=n},calculateTimes:function(){this.timeToNextDirection=Math.round((1-this.ratioCompletedRoute)*this.currentDirection.duration),this.timeToDestination=Math.round((1-this.ratioCompletedRoute)*this.route.summary.duration)},calculateDistances:function(){var t,i,e,n,o=ffwdme.utils.Geo,r=10,s=this.route.directions,a=this.route.directions[this.nearest.directionIndex],c=a.path[this.nearest.nextPathIndex],u=o.distance(this.position,c);for(t=u,e=this.nearest.nextPathIndex,n=a.path.length-1;e<n&&a.path[e+1];e++)t+=o.distance(a.path[e],a.path[e+1]);for(t>=10&&(t-=r),this.distanceToNextDirection=t,i=t,e=this.nearest.directionIndex+1,n=s.length;e<n;e++)i+=s[e].distance;this.distanceToDestination=i},nearest:null,raw:null,positionRaw:null,position:null,distanceToNextDirection:null,distanceToDestination:null,timeToNextDirection:null,timeToDestination:null,ratioCompletedDirection:null,ratioCompletedRoute:null,nextDirection:null,finalDirection:null,arrived:null});i.exports=o},{"./class":1}],7:[function(t,i,e){var n=t("./class"),o=t("./utils/geo"),r=n.extend({constructor:function(){},summary:null,directions:null,parse:function(t){this.summary=t.summary,this.directions=t.directions;for(var i=0,e=this.directions.length;i<e;i++){for(var n=this.directions[i].path,o=[],r=0,s=n.length;r<s;r++)o.push(new ffwdme.LatLng(n[r][0],n[r][1]));this.directions[i].path=o}return this},start:function(){var t=this.directions[0],i=t.path[0];return i},destination:function(){var t=this.directions[this.directions.length-1],i=t.path[t.path.length-1];return i},nearestTo:function(t,i,e,n){for(var r={distance:999999,point:null,directionIndex:null,prevPathIndex:null,nextPathIndex:null},s=o,a=n?Math.min(n,this.directions.length):this.directions.length,c=i;c<a;c++)for(var u=this.directions[c],l=u.path.length-1,h=c===i?e:0,f=h;f<l;f++){var d=s.closestOnLine(u.path[f],u.path[f+1],t),p=s.distance(t,d);r.distance<p||(r.distance=p,r.point=d,r.directionIndex=c,r.prevPathIndex=f,r.nextPathIndex=f+1)}return r}},{decodePolyline:function(t){for(var i=t.length,e=0,n=[],o=0,r=0;e<i;){var s,a=0,c=0;do s=t.charCodeAt(e++)-63,c|=(31&s)<<a,a+=5;while(s>=32);var u=1&c?~(c>>1):c>>1;o+=u,a=0,c=0;do s=t.charCodeAt(e++)-63,c|=(31&s)<<a,a+=5;while(s>=32);var l=1&c?~(c>>1):c>>1;r+=l,n.push([1e-5*o,1e-5*r])}return n}});i.exports=r},{"./class":1,"./utils/geo":10}],8:[function(t,i,e){var n=t("../class"),o=n.extend({constructor:function(t){this.options=t;for(var i,e=["start","dest","rerouting"],n=0,o=e.length;n<o;n++)i=e[n],this[i]=t&&t[i];return this.start||(this.start=ffwdme.geolocation.last.point),this},options:null,lastRoute:null,fetch:function(){throw"ffwdme.routing.Base is an abstract class. You must use a child class."},eventPrefix:function(){return this.rerouting?"reroutecalculation":"routecalculation"},success:function(t,i){this.lastRoute=i,ffwdme.trigger(this.eventPrefix()+":success",{routing:this,route:i,response:t})},error:function(t){ffwdme.trigger(this.eventPrefix()+":error",{routing:this,error:t})}});i.exports=o},{"../class":1}],9:[function(t,i,e){var n=t("./base"),o=n.extend({constructor:function(t){this.base(t),this.bindAll(this,"parse","error"),this.apiKey=ffwdme.options.graphHopper.apiKey,t.anchorPoint&&(this.anchorPoint=t.anchorPoint,this.direction=this.start,this.start=this.anchorPoint)},BASE_URL:"//graphhopper.com/api/1/",apiKey:null,modifier:"fastest",routeType:"car",lang:"en_EN",route:null,anchorPoint:null,direction:null,fetch:function(){var t="";this.direction&&(t+="&point="+[this.direction.lat,this.direction.lng].join("%2C"));var i=[this.BASE_URL,"route?type=jsonp","&key=",this.apiKey,"&locale=",this.lang,"&vehicle=",this.routeType,"&weighting=",this.modifier,"&point=",[this.start.lat,this.start.lng].join("%2C"),t,"&point=",[this.dest.lat,this.dest.lng].join("%2C")];return ffwdme.trigger(this.eventPrefix()+":start",{routing:this}),ffwdme.utils.Proxy.get({url:i.join(""),success:this.parse,error:this.error}),ffwdme},error:function(t){this.base(t)},parse:function(t){if(t.info.errors)return this.error(t);var i=t.paths[0],e={directions:[]};e.summary={distance:parseInt(i.distance,10),duration:i.time/1e3};var n,o,r,s=ffwdme.Route.decodePolyline(i.points),a=i.instructions;a.pop();for(var c=0,u=a.length;c<u;c++)n=a[c],o={instruction:n.text,distance:parseInt(n.distance,10),duration:n.time/1e3,turnAngle:this.extractTurnAngle(n.sign),turnType:this.extractTurnType(n)},o.path=s.slice(n.interval[0],n.interval[1]+1),r=o.instruction.split(/(?:on |near |onto |at |Head )/).pop(),o.street=r.length==o.instruction.length?"":r,e.directions.push(o);this.route=(new ffwdme.Route).parse(e),this.success(t,this.route)},extractTurnType:function(t){var i;switch(t.sign){case 0:i="C";break;case-2:i="TL";break;case-1:i="TSLL";break;case-3:i="TSHL";break;case 2:i="TR";break;case 1:i="TSLR";break;case 3:i="TSHR";break;case 6:i="EXIT"+t.exit_number}return i},extractTurnAngle:function(t){var i;switch(t){case 0:i=0;break;case-2:i=90;break;case-1:i=45;break;case-3:i=135;break;case 2:i=-90;break;case 1:i=-45;break;case 3:i=-135}return i}});i.exports=o},{"./base":8}],10:[function(t,i,e){i.exports={EARTH_RADIUS:6378137,DEG_TO_RAD_FACTOR:Math.PI/180,distance:function(t,i){var e=t.lat*this.DEG_TO_RAD_FACTOR,n=i.lat*this.DEG_TO_RAD_FACTOR,o=Math.sin(e)*Math.sin(n)+Math.cos(e)*Math.cos(n)*Math.cos((i.lng-t.lng)*this.DEG_TO_RAD_FACTOR);return parseInt(this.EARTH_RADIUS*Math.acos(Math.min(o,1)))},closestOnLine:function(t,i,e){var n=t.lat,o=t.lng,r=i.lat,s=i.lng,a=e.lat,c=e.lng,u=r-n,l=s-o;if(0===u&&0===l)return t;var h,f=((a-n)*u+(c-o)*l)/(u*u+l*l);return h=f<0?[n,o]:f>1?[r,s]:[n+f*u,o+f*l],new ffwdme.LatLng(h[0],h[1])}}},{}],11:[function(t,i,e){var n={_tags:{},callbacks:{},errorCallbacks:{},successfullCallbacks:{},devNull:function(){},_idCounter:0,_idPrefix:"ffwdme-Proxy-",_callbackPrefix:"ffwdme.utils.Proxy.callbacks.",_headTag:document.getElementsByTagName("head")[0],checkForTimeout:function(t){this.successfullCallbacks[t]!==!0&&this.errorCallbacks[t]()},removeTimeoutCheck:function(t){this.callbacks[t]=this.devNull,delete this.errorCallbacks[t]},get:function(t){t=t||{};var i=t.callback||"callback",e=this._idPrefix+this._idCounter++,n="cb"+this._idCounter,o=this,r=[t.url,t.url.indexOf("?")>-1?"&":"?",i,"=",this._callbackPrefix,n].join(""),s=this.buildScriptTag(r,e),a=t.success;this.callbacks[n]=function(t){o.successfullCallbacks[n]=!0,o.removeTimeoutCheck(n),a&&a(t)};var c=t.error;this.errorCallbacks[n]=function(){o.removeTimeoutCheck(n),c&&c({error:"timeout"})},this._tags[e]=s,this._headTag.appendChild(s),window.setTimeout(ffwdme.Class.prototype.bind.call(this,this.checkForTimeout,this),t.timeout||1e4,n)},buildScriptTag:function(t,i){var e=document.createElement("script");return e.setAttribute("type","text/javascript"),e.setAttribute("charset","utf-8"),e.setAttribute("src",t),e.setAttribute("id",i),e},removeScriptTag:function(t){this._tags[t]&&(this._headTag.removeChild(this._tags[t]),delete this._tags[t])}};i.exports=n},{}]},{},[3]);